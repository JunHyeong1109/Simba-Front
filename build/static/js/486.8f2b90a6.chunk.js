"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[486],{486:(e,a,s)=>{s.r(a),s.d(a,{default:()=>o});var t=s(338),r=s(379),l=s(43),i=s(674),d=s(579);const n={myStores:["/itda/me/stores","/itda/stores"],storeReviews:()=>"/itda/reviews",storeSummary:e=>"/itda/stores/".concat(e,"/summary"),reviewApprove:e=>[{method:"patch",url:"/itda/reviews/".concat(e,"/approve"),body:{approve:!0}},{method:"patch",url:"/itda/reviews/".concat(e),body:{status:"APPROVED"}}],voucherIssue:e=>[{method:"post",url:"/itda/vouchers/issue",body:e},{method:"post",url:"/itda/vouchers",body:e}]};function c(){var e,a,s,c;const{user:o}=(0,t.KC)()||{},v=(0,t.Zp)();(0,l.useEffect)(()=>{const e=((null===o||void 0===o?void 0:o.role)||"").toString().toUpperCase();o&&"OWNER"!==e&&(alert("\uc0ac\uc7a5\ub2d8 \uc804\uc6a9 \ud398\uc774\uc9c0\uc785\ub2c8\ub2e4."),v("/",{replace:!0}))},[o,v]);const[u,m]=(0,l.useState)([]),[p,h]=(0,l.useState)(!0),[x,N]=(0,l.useState)(""),[j,y]=(0,l.useState)(""),[g,f]=(0,l.useState)([]),[b,w]=(0,l.useState)(!1),[A,S]=(0,l.useState)(""),[I,C]=(0,l.useState)("PENDING"),[P,k]=(0,l.useState)(null),[E,D]=(0,l.useState)(!1),[R,O]=(0,l.useState)(!1),[V,G]=(0,l.useState)(null),[U,q]=(0,l.useState)("\ub9ac\ubdf0 \ubcf4\uc0c1"),[M,B]=(0,l.useState)(""),[F,K]=(0,l.useState)(""),[T,W]=(0,l.useState)(!1);(0,l.useEffect)(()=>{let e=!0;return(async()=>{try{h(!0),N("");let t=[];try{const{data:e}=await i.Ay.get(n.myStores[0]);t=Array.isArray(e)?e:(null===e||void 0===e?void 0:e.items)||[]}catch(l){var a;const{data:e}=await i.Ay.get(n.myStores[1]);t=Array.isArray(e)?e:(null===e||void 0===e?void 0:e.items)||[],null!==o&&void 0!==o&&o.id&&t.length&&null!=(null===(a=t[0])||void 0===a?void 0:a.ownerId)&&(t=t.filter(e=>String(e.ownerId)===String(o.id)))}if(!e)return;var s;if(m(t),t.length>0)y(String(null!==(s=t[0].id)&&void 0!==s?s:t[0].storeId))}catch(d){var t,r;if(!e)return;N((null===d||void 0===d||null===(t=d.response)||void 0===t||null===(r=t.data)||void 0===r?void 0:r.message)||"\ub9e4\uc7a5 \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4."),m([])}finally{e&&h(!1)}})(),()=>{e=!1}},[null===o||void 0===o?void 0:o.id]);const Z=e=>{var a,s,t,r,l,i,d,n,c,o,v,u,m,p,h,x,N,j,y,g;let f=(e.status||"").toString().toUpperCase();if(!f){f=!0===e.approved||!!e.approvedAt?"APPROVED":"PENDING"}return{id:null!==(a=e.id)&&void 0!==a?a:e.reviewId,userId:null!==(s=null!==(t=null!==(r=null!==(l=e.userId)&&void 0!==l?l:e.reviewerId)&&void 0!==r?r:e.writerId)&&void 0!==t?t:null===(i=e.user)||void 0===i?void 0:i.id)&&void 0!==s?s:e.accountId,userName:null!==(d=null!==(n=null!==(c=null!==(o=e.userName)&&void 0!==o?o:e.nickname)&&void 0!==c?c:e.username)&&void 0!==n?n:null===(v=e.user)||void 0===v?void 0:v.name)&&void 0!==d?d:"\uc0ac\uc6a9\uc790",rating:null!==(u=null!==(m=e.rating)&&void 0!==m?m:e.stars)&&void 0!==u?u:0,text:null!==(p=null!==(h=e.text)&&void 0!==h?h:e.content)&&void 0!==p?p:"",date:null!==(x=null!==(N=null!==(j=e.date)&&void 0!==j?j:e.createdAt)&&void 0!==N?N:e.created_at)&&void 0!==x?x:"",images:null!==(y=null!==(g=e.images)&&void 0!==g?g:e.photos)&&void 0!==y?y:[],status:f}};(0,l.useEffect)(()=>{j&&(async e=>{if(e){w(!0),S("");try{const{data:a}=await i.Ay.get(n.storeReviews(),{params:{storeId:e}}),s=(Array.isArray(a)?a:(null===a||void 0===a?void 0:a.items)||[]).map(Z);f(s)}catch(t){var a,s;f([]),S((null===t||void 0===t||null===(a=t.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||"\ub9ac\ubdf0\ub97c \ubd88\ub7ec\uc624\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4.")}finally{w(!1)}}})(j)},[j]),(0,l.useEffect)(()=>{if(!j)return;let e=!0;return(async()=>{try{D(!0);const{data:a}=await i.Ay.get(n.storeSummary(j));if(!e)return;k(a||null)}catch(a){k(null)}finally{e&&D(!1)}})(),()=>{e=!1}},[j]);const _=(0,l.useMemo)(()=>{const e=I.toUpperCase();return g.filter(a=>a.status===e)},[g,I]);return(0,d.jsxs)("div",{className:"rvap-root",children:[(0,d.jsxs)("header",{className:"rvap-head",children:[(0,d.jsx)("h1",{className:"rvap-title",children:"\ub9ac\ubdf0 \ud655\uc778 \ubc0f \uc644\ub8cc\ucc98\ub9ac"}),(0,d.jsxs)("div",{className:"rvap-controls",children:[(0,d.jsx)("select",{className:"rvap-select",value:j,onChange:e=>y(e.target.value),disabled:p||0===u.length,children:u.map(e=>{var a;const s=null!==(a=e.id)&&void 0!==a?a:e.storeId;return(0,d.jsx)("option",{value:s,children:e.name||e.storeName||"\ub9e4\uc7a5#".concat(s)},s)})}),(0,d.jsx)("div",{className:"rvap-tabs",role:"tablist","aria-label":"\ub9ac\ubdf0 \uc0c1\ud0dc",children:["PENDING","APPROVED"].map(e=>(0,d.jsx)("button",{type:"button",className:"rvap-tab ".concat(I===e?"active":""),role:"tab","aria-selected":I===e,onClick:()=>C(e),children:"PENDING"===e?"\uac80\uc218 \ub300\uae30":"\uc2b9\uc778\ub428"},e))})]})]}),!p&&!x&&j&&(0,d.jsx)("section",{className:"rvap-summary",children:E?(0,d.jsx)("div",{className:"rvap-chip muted",children:"\uc694\uc57d \ubd88\ub7ec\uc624\ub294 \uc911\u2026"}):P?(0,d.jsxs)("div",{className:"rvap-summary-grid",children:[(0,d.jsxs)("div",{className:"rvap-summary-item",children:["\ucd1d \ub9ac\ubdf0: ",null!==(e=P.total)&&void 0!==e?e:"-"]}),(0,d.jsxs)("div",{className:"rvap-summary-item",children:["\ud3c9\uade0 \ubcc4\uc810: ",null!==(a=P.avgRating)&&void 0!==a?a:"-"]}),(0,d.jsxs)("div",{className:"rvap-summary-item",children:["\uae0d\uc815: ",null!==(s=P.pos)&&void 0!==s?s:"-"]}),(0,d.jsxs)("div",{className:"rvap-summary-item",children:["\ubd80\uc815: ",null!==(c=P.neg)&&void 0!==c?c:"-"]})]}):(0,d.jsx)("div",{className:"rvap-chip muted",children:"\uc694\uc57d \uc5c6\uc74c"})}),p&&(0,d.jsx)("div",{className:"rvap-empty",children:"\ub9e4\uc7a5 \ubaa9\ub85d\uc744 \ubd88\ub7ec\uc624\ub294 \uc911\u2026"}),!p&&x&&(0,d.jsx)("div",{className:"rvap-error",children:x}),!p&&!x&&(0,d.jsx)("section",{className:"rvap-list",children:b?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"rvap-card rvap-skeleton"}),(0,d.jsx)("div",{className:"rvap-card rvap-skeleton"})]}):A?(0,d.jsx)("div",{className:"rvap-error",children:A}):0===_.length?(0,d.jsx)("div",{className:"rvap-empty",children:"\ud574\ub2f9 \uc0c1\ud0dc\uc758 \ub9ac\ubdf0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}):_.map(e=>(0,d.jsxs)("article",{className:"rvap-card",children:[(0,d.jsxs)("div",{className:"rvap-card-head",children:[(0,d.jsx)("div",{className:"rvap-avatar",children:"\ud83d\udc64"}),(0,d.jsxs)("div",{className:"rvap-meta",children:[(0,d.jsx)("div",{className:"rvap-user",children:e.userName}),(0,d.jsx)("div",{className:"rvap-date",children:e.date}),(0,d.jsxs)("div",{className:"rvap-stars",children:["\u2605".repeat(e.rating||0),"\u2606".repeat(Math.max(0,5-(e.rating||0)))]})]})]}),(0,d.jsx)("div",{className:"rvap-text",children:e.text}),Array.isArray(e.images)&&e.images.length>0&&(0,d.jsx)("div",{className:"rvap-images",children:e.images.map((a,s)=>(0,d.jsx)("img",{src:a,alt:"review-".concat(e.id,"-").concat(s)},s))}),(0,d.jsx)("div",{className:"rvap-actions",children:(0,d.jsx)("button",{type:"button",className:"rvap-btn gift",onClick:()=>(e=>{const a=new Date,s=e=>e.toISOString().slice(0,10);G(e),q("\ub9ac\ubdf0 \ubcf4\uc0c1"),B(s(a)),K(s(new Date(a.getTime()+2592e6))),O(!0)})(e),children:"\ubcf4\uc0c1"})})]},e.id))}),R&&(0,d.jsx)("div",{className:"rvap-modal-backdrop",onClick:()=>!T&&O(!1),children:(0,d.jsxs)("div",{className:"rvap-modal",onClick:e=>e.stopPropagation(),children:[(0,d.jsx)("h3",{className:"rvap-modal-title",children:"\ubcf4\uc0c1(\ubc14\uc6b0\ucc98) \ubc1c\uae09"}),(0,d.jsxs)("div",{className:"rvap-modal-body",children:[(0,d.jsxs)("label",{className:"rvap-field",children:[(0,d.jsx)("span",{className:"rvap-label",children:"\uc81c\ubaa9"}),(0,d.jsx)("input",{className:"rvap-input",value:U,onChange:e=>q(e.target.value)})]}),(0,d.jsxs)("div",{className:"rvap-grid2",children:[(0,d.jsxs)("label",{className:"rvap-field",children:[(0,d.jsx)("span",{className:"rvap-label",children:"\uc2dc\uc791\uc77c"}),(0,d.jsx)("input",{className:"rvap-input",type:"date",value:M,onChange:e=>B(e.target.value)})]}),(0,d.jsxs)("label",{className:"rvap-field",children:[(0,d.jsx)("span",{className:"rvap-label",children:"\uc885\ub8cc\uc77c"}),(0,d.jsx)("input",{className:"rvap-input",type:"date",value:F,onChange:e=>K(e.target.value)})]})]})]}),(0,d.jsxs)("div",{className:"rvap-modal-actions",children:[(0,d.jsx)("button",{className:"rvap-btn ghost",onClick:()=>!T&&O(!1),children:"\ucde8\uc18c"}),(0,d.jsx)("button",{className:"rvap-btn gift",disabled:T,onClick:async()=>{try{var e,a,s,t;if(!V)return;const l=null!==(e=null!==(a=null!==(s=V.userId)&&void 0!==s?s:V.reviewerId)&&void 0!==a?a:V.writerId)&&void 0!==e?e:null===(t=V.user)||void 0===t?void 0:t.id;if(!l)return void alert("\ub9ac\ubdf0 \uc791\uc131\uc790 ID\ub97c \ucc3e\uc744 \uc218 \uc5c6\uc5b4 \ubcf4\uc0c1\uc744 \ubc1c\uae09\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4.");if(W(!0),"APPROVED"!==V.status){const e=n.reviewApprove(V.id);let a,s=!1;for(const t of e)try{await i.Ay[t.method](t.url,t.body),s=!0;break}catch(c){a=c}if(!s)throw a}const d={userId:l,storeId:Number(j),title:U,startAt:M,endAt:F},o=n.voucherIssue(d);let v,u=!1;for(const e of o)try{await i.Ay[e.method](e.url,e.body),u=!0;break}catch(c){v=c}if(!u)throw v;f(e=>e.map(e=>e.id===V.id?(0,r.A)((0,r.A)({},e),{},{status:"APPROVED"}):e)),O(!1),G(null),C("APPROVED"),alert("\ubcf4\uc0c1\uc774 \ubc1c\uae09\ub418\uc5c8\uc2b5\ub2c8\ub2e4.")}catch(c){var l,d;console.warn("voucher issue failed:",c);const e=(null===c||void 0===c||null===(l=c.response)||void 0===l||null===(d=l.data)||void 0===d?void 0:d.message)||(null===c||void 0===c?void 0:c.message)||"\ubcf4\uc0c1 \ubc1c\uae09 \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.";alert(e)}finally{W(!1)}},children:T?"\ubc1c\uae09 \uc911\u2026":"\ubc1c\uae09"})]})]})})]})}function o(){return(0,d.jsx)("div",{"data-app":"map",children:(0,d.jsxs)(t.BV,{children:[(0,d.jsx)(t.qh,{index:!0,element:(0,d.jsx)(c,{})}),(0,d.jsx)(t.qh,{path:"*",element:(0,d.jsx)(t.C5,{to:".",replace:!0})})]})})}}}]);
//# sourceMappingURL=486.8f2b90a6.chunk.js.map