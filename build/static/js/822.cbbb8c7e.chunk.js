"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[822],{822:(e,a,s)=>{s.r(a),s.d(a,{default:()=>c});var i=s(338),l=s(379),t=s(43),d=s(674),r=s(579);function n(){const e=(0,i.KC)(),[a,s]=(0,t.useState)((null===e||void 0===e?void 0:e.user)||null),[n,c]=(0,t.useState)([]),[m,o]=(0,t.useState)(!1),[v,u]=(0,t.useState)([]),[p,h]=(0,t.useState)(!1),[y,g]=(0,t.useState)("ISSUED"),[x,j]=(0,t.useState)(!(null!==e&&void 0!==e&&e.user)),N=(null===a||void 0===a?void 0:a.email)||"",S=((null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.email)||"U").toString().slice(0,1).toUpperCase(),f=(null===a||void 0===a?void 0:a.username)||(null===a||void 0===a?void 0:a.name)||(null===a||void 0===a?void 0:a.email)||"\uc0ac\uc6a9\uc790";(0,t.useEffect)(()=>{let a=!0;return(async()=>{try{if(null!==e&&void 0!==e&&e.user)return void(a&&(s(e.user),j(!1)));j(!0);const{data:i}=await d.Ay.get("/itda/me");a&&s(i||null)}catch(i){a&&s(null)}finally{a&&j(!1)}})(),()=>{a=!1}},[null===e||void 0===e?void 0:e.user]),(0,t.useEffect)(()=>{if(null===a||void 0===a||!a.id)return;let e=!0;return(async()=>{try{o(!0);const{data:s}=await d.Ay.get("/itda/reviews",{params:{userId:a.id}});e&&c(Array.isArray(s)?s:(null===s||void 0===s?void 0:s.items)||[])}catch(s){e&&c([])}finally{e&&o(!1)}})(),()=>{e=!1}},[null===a||void 0===a?void 0:a.id]);const b=async e=>{if(null!==a&&void 0!==a&&a.id){h(!0);try{const{data:a}=await d.Ay.get("/itda/me/vouchers",{params:{filter:e||y||"ISSUED"}}),s=(Array.isArray(a)?a:(null===a||void 0===a?void 0:a.items)||[]).map(a=>{var s,i,t,d;const r=a.storeName||(null===(s=a.store)||void 0===s?void 0:s.name)||"",n=a.title||a.name||"\ubc14\uc6b0\ucc98",c=null!==(i=null!==(t=null!==(d=a.id)&&void 0!==d?d:a.voucherId)&&void 0!==t?t:a.uuid)&&void 0!==i?i:a.code,m=(a.status||e||"ISSUED").toString().toUpperCase(),o=a.startAt||a.startDate||a.validFrom||a.validFromAt||null,v=a.endAt||a.endDate||a.validTo||a.validToAt||null;return(0,l.A)((0,l.A)({},a),{},{id:c,storeName:r,title:n,status:m,start:o,end:v})});u(s)}catch(s){u([])}finally{h(!1)}}};(0,t.useEffect)(()=>{null!==a&&void 0!==a&&a.id&&b(y)},[null===a||void 0===a?void 0:a.id,y]);const w=(0,t.useMemo)(()=>({ISSUED:{label:"\ubc1c\uae09\ub428",chip:"success"},USED:{label:"\uc0ac\uc6a9\ub428",chip:"warn"},EXPIRED:{label:"\ub9cc\ub8cc\ub428",chip:"muted"}}),[]),E=e=>{if(!e)return"-";try{const a=new Date(e);if(!isNaN(a))return a.toISOString().slice(0,10)}catch(a){}return String(e).slice(0,10)};return(0,r.jsxs)("div",{className:"mypage-root",children:[(0,r.jsxs)("header",{className:"mypage-header",children:[(0,r.jsx)("div",{className:"logo-text",children:"\ub9ac\ubdf0\uc5b4 \ub9c8\uc774\ud398\uc774\uc9c0"}),(0,r.jsxs)("div",{className:"mypage-user",children:[(0,r.jsxs)("div",{className:"mypage-user-meta",children:[(0,r.jsx)("span",{className:"mypage-user-name",children:f}),N&&(0,r.jsx)("span",{className:"mypage-user-mail",children:N})]}),(0,r.jsx)("div",{className:"mypage-avatar","aria-hidden":!0,children:S})]})]}),(0,r.jsxs)("main",{className:"mypage-main",children:[(0,r.jsxs)("section",{className:"mypage-section","aria-label":"\ub9ac\ubdf0 \ubaa9\ub85d",children:[(0,r.jsx)("div",{className:"mypage-section-head",children:(0,r.jsx)("h2",{className:"mypage-section-title",children:"\ub9ac\ubdf0 \ubaa9\ub85d"})}),(0,r.jsx)("div",{className:"mypage-list",children:m?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mypage-card mypage-skeleton"}),(0,r.jsx)("div",{className:"mypage-card mypage-skeleton"})]}):0===n.length?(0,r.jsx)("div",{className:"mypage-empty",children:"\uc544\uc9c1 \uc791\uc131\ud55c \ub9ac\ubdf0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}):n.map(e=>(0,r.jsxs)("article",{className:"mypage-card",children:[(0,r.jsxs)("div",{className:"mypage-store",children:[(0,r.jsx)("div",{className:"mypage-store-thumb","aria-hidden":!0,children:"\ud83d\udcf7"}),(0,r.jsxs)("div",{className:"mypage-store-info",children:[(0,r.jsx)("div",{className:"mypage-store-name",children:e.storeName}),e.address&&(0,r.jsx)("div",{className:"mypage-store-addr",title:e.address,children:e.address}),e.category&&(0,r.jsx)("div",{className:"mypage-store-cat",children:e.category})]})]}),(0,r.jsxs)("div",{className:"mypage-review",children:[(0,r.jsx)("div",{className:"mypage-avatar sm","aria-hidden":!0,children:"\ud83d\udc64"}),(0,r.jsxs)("div",{className:"mypage-review-body",children:[(0,r.jsxs)("div",{className:"mypage-review-meta",children:[(0,r.jsx)("span",{className:"mypage-review-author",children:f}),e.date&&(0,r.jsx)("time",{className:"mypage-review-date",children:e.date})]}),e.text&&(0,r.jsx)("p",{className:"mypage-review-text",children:e.text})]})]})]},e.id))})]}),(0,r.jsxs)("section",{className:"mypage-section","aria-label":"\ubc14\uc6b0\ucc98 \ubaa9\ub85d",children:[(0,r.jsxs)("div",{className:"mypage-section-head",children:[(0,r.jsx)("h2",{className:"mypage-section-title",children:"\ubc14\uc6b0\ucc98 \ubaa9\ub85d"}),(0,r.jsx)("div",{className:"mypage-tabs",role:"tablist","aria-label":"\ubc14\uc6b0\ucc98 \uc0c1\ud0dc \ud544\ud130",children:["ISSUED","USED","EXPIRED"].map(e=>{var a;return(0,r.jsx)("button",{type:"button",className:"mypage-tab ".concat(y===e?"active":""),role:"tab","aria-selected":y===e,onClick:()=>g(e),children:(null===(a=w[e])||void 0===a?void 0:a.label)||e},e)})})]}),(0,r.jsx)("div",{className:"mypage-list",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mypage-card mypage-skeleton"}),(0,r.jsx)("div",{className:"mypage-card mypage-skeleton"})]}):0===v.length?(0,r.jsx)("div",{className:"mypage-empty",children:"\ud574\ub2f9 \uc0c1\ud0dc\uc758 \ubc14\uc6b0\ucc98\uac00 \uc5c6\uc2b5\ub2c8\ub2e4."}):v.map(e=>{const a=w[e.status]||w.ISSUED;return(0,r.jsxs)("article",{className:"mypage-card mypage-reward",children:[(0,r.jsx)("div",{className:"mypage-chip ".concat(a.chip),children:a.label}),(0,r.jsxs)("div",{className:"mypage-reward-body",children:[(0,r.jsxs)("div",{className:"mypage-reward-title",children:[e.storeName?"[".concat(e.storeName,"] "):"",e.title]}),(0,r.jsxs)("div",{className:"mypage-reward-period",children:["\uc0ac\uc6a9\uae30\uac04: ",E(e.start)," ~ ",E(e.end)]})]}),"ISSUED"===e.status&&(0,r.jsx)("div",{style:{marginLeft:"auto"},children:(0,r.jsx)("button",{type:"button",className:"mypage-btn use",onClick:()=>(async e=>{if(e&&window.confirm("\uc774 \ubc14\uc6b0\ucc98\ub97c \uc0ac\uc6a9 \ucc98\ub9ac\ud558\uc2dc\uaca0\uc2b5\ub2c8\uae4c?"))try{await d.Ay.patch("/itda/me/vouchers/".concat(e,"/use")),b()}catch(i){var a,s;const e=(null===i||void 0===i||null===(a=i.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.message)||(null===i||void 0===i?void 0:i.message)||"\uc0ac\uc6a9 \ucc98\ub9ac \uc911 \uc624\ub958\uac00 \ubc1c\uc0dd\ud588\uc2b5\ub2c8\ub2e4.";alert(e)}})(e.id),title:"\ubc14\uc6b0\ucc98 \uc0ac\uc6a9 \ucc98\ub9ac",children:"\uc0ac\uc6a9 \ucc98\ub9ac"})})]},e.id)})})]})]})]})}function c(){return(0,r.jsx)("div",{"data-app":"map",children:(0,r.jsxs)(i.BV,{children:[(0,r.jsx)(i.qh,{index:!0,element:(0,r.jsx)(n,{})}),(0,r.jsx)(i.qh,{path:"*",element:(0,r.jsx)(i.C5,{to:".",replace:!0})})]})})}}}]);
//# sourceMappingURL=822.cbbb8c7e.chunk.js.map